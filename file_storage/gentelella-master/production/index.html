<!DOCTYPE html>
<html lang="ko">  <!-- en 이였음 -->
<script src="../production/serveraddr.js"></script>
<script src="../vendors/custom/jquery-3.2.1.min.js"></script>
<!-- 헤더에는 로컬 디스크에서 스타일쉬트 가져오는걸로 끝난다 -->
<head>
    <script>
        //alert(server_url)
        var ws = new WebSocket("ws://"+server_url+":8100/websocket");
        var indexmacaddr="00:06:7A:05:04:91;table:20;end"
        var table=5;
        array1=indexmacaddr.split(';');
        array1.pop();
        var table1=array1.pop();
        table=table1.substr(6);
       // console.log(table);
     //   console.log(array1);

        function maketable(){
         //   console.log("시작");
            for(var f=0;f<table;f++) {
                document.write('<button id = "first" title="Loading..." class="base"onmousedown="savemac(this)"  style=" box-shadow: 0 0 2px 2px lightgray;cursor:pointer;font-size:19px;border-radius:2px;border-color:white;border: 3px solid white;resize: none;width:180px;height:120px;px;"></button>')
                var rec = "first"+(f);
                document.getElementById("first").id = rec;
                var a= document.getElementById(rec)
                a.innerHTML="<h4>&nbsp</h4>"+"<h5>"+array1[f]+"</h5><h5>Loading</h5><h6>&nbsp</h6>";
                document.getElementById("A05").innerHTML=table;
                if(array1[f]==null){
                    var a="<h4>장비 등록안됨 </h4>"+"&nbsp<h6>&nbsp</h6><h6>&nbsp</h6>";
                    document.getElementById(rec).innerHTML=a;
                    document.getElementById(rec).className="Loading";
                    document.getElementById(rec).title="임시 추가등록";
                }
            }
        }
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- 캐쉬 안쌓이게 해보자.... -->
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <META http-equiv="Expires" content="-1">
    <META http-equiv="Pragma" content="no-cache">
    <META http-equiv="Cache-Control" content="No-Cache">
    <!-- 파비콘을 설정한다. png 를 ico로 변환하는 과정이 필요 -->
    <link rel="shortcut icon" href="./jmpsys_wifi.ico" >
    <title>uManager 3.3</title>
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 링크 엘리먼트는 웹url이 지정하는 파일을 스타일쉬트와 연결시켜준다
    즉 CSS 내용을 축적하여 만들어 나가기 위한 것이지 자바스크립트와는 관계가 없다. -->
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->
    <link href="../vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap-progressbar -->
    <link href="../vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="../vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">

    <style>
        table.dataTable.select tbody tr,
        table.dataTable thead th:first-child {
            cursor: pointer;
        }

        /* 소켓 데이터에 따라 변하는 스타일 지정하는 곳*/
        .base:hover{background-color:lightgray;text-align: center}
        .Loading{background-color:white;}
        .flag0{background-color:#2A3F54;color:white;text-align: center;}
        .flag0:hover{background-color:#2A3F44;text-align: center;}
        .flag00{background-color:palegreen;text-align: center;}

        .flag1{background-color:darkblue;color:white;text-align: center}
        .flag2{background-color:pink;text-align: center}
        .flag3{background-color:yellow;text-align: center}
        .flag4{background-color:yellow;color:orangered;text-align: center}
        .flag5{background-color:red;color:orange;}



    </style>


</head>

<body class="nav-md">

<!-- 숨겨진 레이어 -->

<!-- 숨겨진 레이어 -->


<div class="container body">
    <div class="main_container">
        <div class="col-md-3 left_col">
            <div class="left_col scroll-view">
                <div class="navbar nav_title" style="border: 0;">
                    <a href="index.html"><center> <img src="images/logo.png"style="width:90%;height:90% ;"></center></a>
                </div>

                <div class="clearfix"></div>

                <!-- menu profile quick info -->
                <div class="profile clearfix">
                    <div class="profile_pic">
                        <img src="images/jsn270.png" alt="..." class="img-circle profile_img">
                    </div>
                    <div class="profile_info">
                        <span>Wemcome,</span>
                        <h2>Manager</h2>
                    </div>
                </div>
                <!-- /menu profile quick info -->

                <br />

                <!-- sidebar menu -->
                <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                    <div class="menu_section">
                        <h3>JMPSYSTEMS uManager 3.3</h3>
                        <ul class="nav side-menu">
                            <li><a><i class="fa fa-area-chart"></i> Basic Management <span class="fa fa-chevron-down"></span></a>
                                <ul class="nav child_menu">
                                    <li><a href='index.html'>Status</a></li>
                                    <li><a href='index1.html'>Management</a></li>
                                    <!--li><a href='index2.html'>AP 관계도</a></li-->
                                </ul>
                            </li>
                            <li><a><i class="fa fa-archive"></i> Field Management <span class="fa fa-chevron-down"></span></a>
                                <ul class="nav child_menu">
                                    <li><a onclick="mapinfo()">Outdoor</a></li>
                                    <li><a href='indoor.html'>Indoor</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="menu_section">
                        <!--h3>개발예정 메뉴</h3-->
                        <ul class="nav side-menu">
                            <!--li><a><i class="fa fa-bug"></i> 버그신고 <span class="fa fa-chevron-down"></span></a>
                                <ul class="nav child_menu">
                                    <li><a target="_blank" href="http://www.jmpsys.com">개발자에게 알리기</a></li>
                                    <li><a href='#Redirect'>프로젝트 블로그</a></li>
                                </ul>
                            </li-->
                            <li><a target="_blank" href="http://www.jmpsys.com"><i class="fa fa-laptop"></i> Go JMP Site <span class="label label-success pull-right">JMPSYS</span></a></li>
                        </ul>
                    </div>

                </div>
                <!-- /sidebar menu -->

                <!-- /menu footer buttons -->
                <div class="sidebar-footer hidden-small">
                    <!--a data-toggle="tooltip" data-placement="top" title="Settings">
                        <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                    </a>
                    <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                        <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                    </a>
                    <a data-toggle="tooltip" data-placement="top" title="Lock">
                        <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                    </a>
                    <a-- data-toggle="tooltip" data-placement="top" title="Logout">
                        <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                    </a-->
                </div>
                <!-- /menu footer buttons -->
            </div>
        </div>
        <!-- top navigation -->
        <div class="top_nav">
            <div class="nav_menu">
                <nav>
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>

                    <ul class="nav navbar-nav navbar-right">
                        <!--li class="">
                            <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                <img src="images/jsn270.png" alt="">무선 관리자
                                <span class=" fa fa-angle-down"></span>
                            </a>
                            <ul class="dropdown-menu dropdown-usermenu pull-right">
                                <li><a href="javascript:;"> Profile</a></li>
                                <li>
                                    <a href="javascript:;">
                                        <span class="badge bg-red pull-right">50%</span>
                                        <span>Settings</span>
                                    </a>
                                </li>
                                <li><a href="javascript:;">Help</a></li>
                                <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                            </ul>
                        </li-->
                    </ul>
                </nav>
            </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">  <!-- 오른쪽 전체를 지칭 -->
            <!-- 여기까진 모든 젠텔레라 페이지가 똑같다...-->

            <!-- top tiles -->
            <div class="row tile_count"> <!-- 최상단 카운터들 -->
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Download</span>
                    <div class="count" id="A00">0</div>  <!-- A00 에 값 대입 -->
                    <!--span><i class="fa fa-user"></i> Total Download Trafic</span-->
                </div>
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-clock-o"></i> Upload</span>
                    <div class="count"  id="A01">0</div>
                    <!--i class="fa fa-clock-o"></i> <span>Total Upload Trafic</span-->
                </div>
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Trafic</span>
                    <div class="count green" id="A02" >0</div>
                    <!--i class="fa fa-user"></i> <span>Real Time Trafic</span-->
                </div>
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-clock-o"></i> Service Time</span>
                    <div class="count" style="font-size:30px" id = "A03" >0</div>
                    <!--i class="fa fa-clock-o"></i><span> Operation Time</span-->
                </div>
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Operating Rate</span>
                    <div class="count" id= "A04">0</div>
                    <i id="A04rate" class="green">34%</i>
                </div>
                <div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Registration Equipment</span>
                    <div class="count" id= "A05"></div>
                    <!--i class="fa fa-user"></i> <span>Registration Equipment</span-->
                </div>

            </div>    <!-- 우측공간 최상단 카운터들 -->
            <!-- /top tiles -->
            <hr/>   <!-- 우측공간 최상단 카운터들 -->
            <!-- /top tiles -->
            <div class="clearfix"></div>

            <!-- 블럭을 shrink 한줄만 copy 해오면 되네.. 블럭을 인식하는건 역시 this is webstorm !!
            <div class="">  <!-- 우측공간 최상단 카운터 아래쪽 공간 정의 -->
            <div class="page-title">
                <div class="title_left">
                    <!-- 파파 아이콘 사용 -->
                    <h3><i class="fa fa-cogs" aria-hidden="true"></i> Wireless AP Monitoring </i></h3>
                </div>

                <div class="title_right">

                </div>
            </div>  <!-- 테이블 감싸고 제품과 오른쪽 더비 써치 & Go -->

            <div class="clearfix"></div>

            <div class="row" style="max_height:100%;" > <!-- 우측 공간에서 row 하나 만든다. -->
                <!-- xs < 768 | sm > 768 | md > 992 | lg > 1200
<div id="show_file" class="col-md-6">
<!-- 부트스트랩 정의 ::  컨테이너 너비   auto   |   750px  |   970px  |   1170px -->

                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                                <!--input type="text" class="form-control" id="findme" placeholder="Search for..."-->
                        <div style="min-width:100%; height:100%;">
                                                        <h2>AP Monitoring <button class="btn btn-default" type="button" onclick="findString(1);">IP Sorting</button>
                                                            <select name="evidence_selected" id="evidence_selected">
                                                                <option id="def"value='' selected>---MESH ID LIST---</option>
                                                            </select>
                                                        </h2>
                            <div class="button" align="center">
                                <script>
                                    maketable();
                                </script>
                            </div>
                        </div>
                    </div>
                </div> <!-- 체빡 영역 -->
                <!-- 실실간 관리 패킷 보여주기 -- 텍스트 에어리어~ -->
            </div> <!-- 우측 공간에서 row 하나 만든다. --> <!-- 반응형 체크때문에 남겨둔 코드 -->
        </div>  <!-- 오른쪽 전체 끝 -->
    </div>
    <!-- /page content -->
    <!-- footer content -->
    <footer>
        <div class="pull-right">
            uManager version 3.3 ----- <a href="http://www.jmpsys.com">JMPSYSTEMS Co., Ltd.</a>
        </div>
        <div class="clearfix"></div>

    </footer>
    <!-- /footer content -->

</div>
</body>
</html>
<script>

    function testtest(meshlist){
        var liststring="<option id=\"def\"value='' selected>---MESH ID LIST---</option>\n"
        if((typeof meshlist!="undefined")) {
            meshlist = meshlist.split(",");
            //var getstringlength=meshlist.length
            console.log(meshlist.length - 1)
            for (i = 0; i < meshlist.length - 1; i++) {
                liststring += "<option id=" + meshlist[i] + ">" + meshlist[i] + "</option>\n"
            }
            //console.log(liststring)
            document.getElementById("evidence_selected").innerHTML=liststring
        }
    }
    $("#evidence_selected").change(function(){

        if ($(this).val()!=''){
            loadxml($(this).val())
            $("#def").val("---MESH ID LIST---").prop("selected", true);
        }
    });
</script>



<script src="../vendors/jQuery-contextMenu-master/dist/jquery.contextMenu.js"></script>
<script src="../vendors/jQuery-contextMenu-master/dist/jquery.ui.position.js"></script>
<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<link href="../vendors/custom/jquery-ui.css" rel="stylesheet" />

<script src="../vendors/custom/jquery-ui.min.js"></script>
<script src="../vendors/custom/jquery.ui-contextmenu.min.js"></script>

<script src="../build/js/custom.min.js"></script>
<script src="../vendors/d3/d3.min.js"></script>
<script src="../vendors/DateJS/build/date.js"></script>

<!-- NProgress -->

<!-- iCheck -->



<script>
    /*
    $('.base').mousedown(function(ev){
        if(ev.which == 3)
        {
            console.log(ev)
            console.log(ev.currentTarget.id)
            alert("Right mouse button clicked on element with classname base");
        }
    });
*/

    /*function ws_close(){
     ws.close();
     }
     var checkUnload = true;
     $(window).on("afterunload", function(){
     if(checkUnload) return ws_close();
     });
     */
    //var nStart = new Date().getTime(); //html 켜진 시간
    for(var s=0;s<table;s++){
        eval("stat"+s+"=new Array();");
        eval("test_compare"+s+"=new Array();");
    }
    //var stat0=new Array();
    //stat0,stat2.......  총 40개의 배열 생성 여기다가 상태넣을거.
    var bootstring=new Array();
    var macstring=new Array();
    var ipstring=new Array();
    var comparetime=new Array();
    var statusstring=new Array();
    var savetime=new Array();
    var uploadstring=new Array();
    var downstring=new Array();
    var upload=new Array();
    var download=new Array();
    var per_minute = new Array();
    var per_minute1 = new Array();
    var realtx=[];
    var ipss=[];
    var realrx=[];
    var atach=[];
    var model=[];
    var websocsend=new Array();
    var uptotal;
    var downtotal;
    var spend_time;
    var string;
    var work,total;



    window.onload = function()
    {
        // Web Socket is connected, send data using send()
        setTimeout(function(){a=ws.send("piping");}, 1000);
        console.log("핑핑");
        //var myTextArea = document.getElementById("textarea1");
        // myTextArea.value = myTextArea.value + "\n" + "First message sent";
        //textarea1.scrollTop = textarea1.scrollHeight;
        console.log(table);
    };
    ws.onmessage = function (evt)
    {
       //console.log(evt.data);
        spend_time_start=evt.data.lastIndexOf(';');
        spend_time=evt.data.substr(spend_time_start+2);
        spend_timeR=spend_time.split("[]");
        spend_time=spend_timeR[0];
        tttt=spend_timeR[1];
        testtest(tttt)
        //console.log(tttt);
        string = evt.data.split(';');
        //바로가면 안되고 특정문자 기준으로 배열로 나눠서 뿌려준다.
        setTimeout(function(){ws.send("piping");}, 100);
        var err=$('.flag5').length;
        var notyet=$('.base').length;
        var und=$('.Loading').length;
        var wait=$('.flag4').length;
        work=table-err-notyet-wait-und.toString();
        total=table-und.toString();
        document.getElementById("A04").innerHTML=work+" / "+total;
        if (string!=""&&evt.data.indexOf("table:")==-1) {
            web_soc_html();
        }
    }
    var rrx=[];
    var rtx=[];


    function web_soc_html(){
        //console.log(spend_time);//서버 열린 시간(초)
        var clocks=Math.floor(spend_time%60);
        var minutes=Math.floor(spend_time/60);
        var hours=Math.floor(minutes/60);
        var day=Math.floor(hours/24);
        /*if(minutes%120==0){ //2시간마다 한번씩 새로고침
         setTimeout(function() {
         window.location.reload(true);

         },1000*60*2)
         }*/
        var string_time=minutes+"M";
        if (minutes>59){
            minutes=minutes%60;
            string_time=hours+"H "+minutes+"M";
            if(hours>23)
            {
                hours=hours%24;
                string_time=day+"D "+hours+"H "+minutes+"M";
            }

        }
        //console.log(string_time)
        document.getElementById("A03").innerHTML=string_time;
        document.getElementById("A03").title=clocks+"Sec";
        string.splice(string.length - 1, 1);
        var getstringlength=string.length
        for(j=1;j<getstringlength;j++) {
            string[j] = string[j].substr(1);
        }
        //console.log(string); //맥과 부트가 붙어있는 스트링
        for(i=0;i<getstringlength;i++) {
            var bootstart=string[i].indexOf("부:");
            bootstring[i] = string[i].substr(bootstart+2, 1);
            //console.log(bootstring);
            var macstart=string[i].indexOf("맥:");
            macstring[i]=string[i].substr(macstart+2,17);
            //console.log(macstring);
            var ipstart=string[i].indexOf("아:");
            var ipend=string[i].lastIndexOf("컴:");
            ipstring[i]=string[i].substr(ipstart+2,ipend-ipstart-3);
            //console.log(ipstring);
            var compstart=string[i].indexOf("컴");
            var compend=string[i].lastIndexOf("상태:");
            comparetime[i]=string[i].substr(compstart+2,compend-compstart-3);
            //console.log(comparetime);
            gotoM=false;
            gotorxM=false;

            var upstart=string[i].indexOf("전송:");
            var upend=string[i].indexOf("수신:");
            uploadstring[i]=string[i].substr(upstart+4,upend-upstart-6);//사용자가 다운로드
            var downstart=string[i].indexOf("수신:");
            var downend=string[i].indexOf("실전:");
            statusstring[i]=string[i].substr(compend+3,downend-compend-3); //ap트래픽
            downstring[i]=string[i].substr(downstart+4,downend-downstart-6);//사용자가 업로드
            var realtxend=string[i].indexOf("실수:");
            realtx[i]=string[i].substr(downend+4,realtxend-downend-6)
            var realrxend=string[i].indexOf("Stalist:");
            realrx[i]=string[i].substr(realtxend+3,realrxend-realtxend-6)

            var atachstart=string[i].indexOf("모델:");
            atach[i]=string[i].substr(realrxend+8,atachstart-realrxend-10)
            var modelend=string[i].indexOf("온도:");
            model[i]=string[i].substr(atachstart+4,modelend-atachstart-6)
            if(macstring[i]=="00:06:7A:40:02:C7"){
                //alert( realrx[i])
               // alert(realtx[i])
            }

            rrx[i]=""
            rtx[i]=""
            realrx[i]=(realrx[i]/10)*8;
            realtx[i]=(realtx[i]/10)*8;
            //console.log(ipstring[i],realrx[i],realtx[i])
            if(realtx[i]>1023){
                realtx[i]=(realtx[i]/1024).toFixed(1);
                rtx[i]="K"
                gotoM=true
            }
            if(realtx[i]>1023&&gotoM==true){
                realtx[i]=(realtx[i]/1024).toFixed(1);
                rtx[i]="M"
            }

            if (realrx[i]>1023){
                realrx[i]=(realrx[i]/1024).toFixed(1);
                rrx[i]="K"
                gotorxM=true
            }

            if (realrx[i]>1023&&gotorxM==true){
                realrx[i]=(realrx[i]/1024).toFixed(1);
                rrx[i]="M"
            }
        //console.log(ipstring[i],realrx[i],realtx[i])
            //console.log(downstring[i])
            //console.log(downstring);
            //console.log(statusstring)
        }
        //    cutup1=(cutup1/1024).toFixed(1)
        //var nend = new Date().getTime();
        //var spendtime=(nend-nStart)/1000;
        //console.log(spendtime);
        //alert(macstring.indexOf(array1[0])) //그 맥에해당하는 위치를 알려준다.
        for(i=0;i<getstringlength;i++){
            var inputhere="<h4>"+ipstring[i]+"&nbsp</h4>"+"<h5>"+macstring[i]+"</h5>"+"<h6 style='color:lightgreen'>Rx:"+realrx[i]+rrx[i]+"b, Tx:"+realtx[i]+rtx[i]+"b"+"</h6><h6 style='color:lightgreen'>&nbspConnection:"+atach[i]+"</h6>";
            // console.log(inputhere);
            for(j=0;j<table;j++){
                if(macstring[i]==array1[j]){
                ipss[j]=ipstring[i]
                    upload[j]=uploadstring[i];
                    download[j]=downstring[i];
                    //alert(i); 소켓에서 오는 배열 번호
                    //alert(j); 그에 일치하는 화면 배열 번호
                    savetime[j]=comparetime[i];
                    eval("var pus=stat"+j)
                    pus.unshift("\n"+statusstring[i]);
                    if(pus.length>10){
                        pus.pop();
                    }
                    var change=document.getElementById("first"+(j)).innerHTML=inputhere;

                    if(bootstring[i]=="0"){
                        document.getElementById('first'+(j)).className="flag0";
                        document.getElementById("first"+(j)).title=pus;
                        // alert("색바뀐당");
                    }
                    else if(bootstring[i]=="1"){
                        document.getElementById('first'+(j)).className="flag1";
                        document.getElementById('first'+(j)).title="Reboot Ok";
                    }
                    else if(bootstring[i]=="2"){
                        document.getElementById('first'+(j)).className="flag2";
                        document.getElementById('first'+(j)).title="Start F/W Update";
                    }
                    else if(bootstring[i]=="3"){
                        document.getElementById('first'+(j)).className="flag3";
                        document.getElementById('first'+(j)).title="Write F/W to Equip";
                    }
                    else if(bootstring[i]=="4"){
                        document.getElementById('first'+(j)).className="flag4";
                        document.getElementById('first'+(j)).title="Wait for Signal";
                    }
                }
            }
            uptotal=0;
            downtotal=0;
            for(j=0;j<table;j++){
                if(upload[j]!=null) {
                    uptotal += Number(upload[j]);
                    downtotal+=Number(download[j]);
                }
            }
        } //화면과 같은 맥과 부트 배열 위치 찾기

        var cutup=String(uptotal);
        var cutdown=String(downtotal);
        var cutup1=uptotal;
        var cutdown1=downtotal;
        if (cutup1>1023){
            cutup1=(cutup/1024).toFixed(1)
            cutup=cutup1+"K"
        }if (cutup1>1023){
            cutup1=(cutup1/1024).toFixed(1)
            cutup=cutup1+"M"
        }if (cutup1>1023){
            cutup1=(cutup1/1024).toFixed(1)
            cutup=cutup1+"G"
        }if (cutup1>1023){
            cutup1=(cutup1/1024).toFixed(1)
            cutup=cutup1+"T"
        }
        if (cutdown1>1023){
            cutdown1=(cutdown/1024).toFixed(1)
            cutdown=cutdown1+"K"
        }if (cutdown1>1023){
            cutdown1=(cutdown1/1024).toFixed(1)
            cutdown=cutdown1+"M"
        }if (cutdown1>1023){
            cutdown1=(cutdown1/1024).toFixed(1)
            cutdown=cutdown1+"G"
        }if (cutdown1>1023){
            cutdown1=(cutdown1/1024).toFixed(1)
            cutdown=cutdown1+"T"
        }
        /* if(cutup.length>4){
         cutup1=(cutup/1024).toFixed(1)+"K"
         cutup=cutup.substring(0,cutup.length-3)
         console.log(cutup)
         console.log(cutup1)
         }if(cutup.length>4){
         cutup1=(cutup/1024).toFixed(1)+"M"
         cutup=cutup.substring(0,cutup.length-4);
         console.log(cutup1)
         }if(cutup.length>4){
         cutup1=(cutup/1024).toFixed(1)+"G"
         cutup=cutup.substring(0,cutup.length-4);
         }if(cutup.length>4){
         cutup1=(cutup/1024).toFixed(1)+"T"
         cutup=cutup.substring(0,cutup.length-4);
         }if(cutdown.length>4){
         cutdown=cutdown.substring(0,cutdown.length-3)+"K";
         }if(cutdown.length>5){
         cutdown=cutdown.substring(0,cutdown.length-4)+"M";
         }if(cutdown.length>5){
         cutdown=cutdown.substring(0,cutdown.length-4)+"G";
         }if(cutdown.length>5){
         cutdown=cutdown.substring(0,cutdown.length-4)+"T";
         }*/
        //부트플래그 넣어보자
        var err=$('.flag5').length;
        var notyet=$('.base').length;
        var und=$('.Loading').length;
        var wait=$('.flag4').length;
        var oprate=Math.floor((table-err-notyet-und)*100/(table-und));

        document.getElementById("A00").innerHTML=cutup;
        document.getElementById("A00").title=AddComma(String(uptotal))+"byte";
        document.getElementById("A01").innerHTML=cutdown;
        document.getElementById("A01").title=AddComma(String(downtotal))+"byte";
        work=table-err-notyet-wait-und.toString();
        total=table-und.toString();
        document.getElementById("A04rate").innerHTML=Math.floor(work/total*100)+"%";
        document.getElementById("A04").innerHTML=work+" / "+total;
    }
    function AddComma(data_value) {
        return Number(data_value).toLocaleString('en');
    }
    setInterval(function() {
        if (uptotal != null) {
            per_minute.unshift(uptotal+downtotal);
            if (per_minute.length > 15) {
                per_minute.pop();
            }
            //console.log(per_minute)
            per_minute1.unshift(downtotal);
            if (per_minute1.length > 15) {
                per_minute1.pop();
            }
            //console.log(per_minute1);

            if (per_minute.length > 10) {
                //console.log(per_minute)
                var minute = (per_minute[0] - per_minute[9])/10;
              //  console.log(minute)
                minute=Math.ceil(minute);
                minute1=minute+"B";
                if(minute>1024){
                    minute=(minute/1023).toFixed(1);
                    minute1=minute+"K";
                }
                if(minute>1024){
                    minute=(minute/1023).toFixed(1);
                    minute1=minute+"M";
                }
                if (minute>1024){
                    minute=(minute/1023).toFixed(1);
                    minute1=minute+"G"
                }
                if (minute<0){}else{
                    document.getElementById("A02").innerHTML = minute1;
                }

                document.getElementById("A02").style="cursor:default";
                //console.log(per_minute, minute);
            }
            else {
                document.getElementById("A02").innerHTML = "Loading...";
                document.getElementById("A02").style="cursor:wait";
            }
        }
    },1000);

    setTimeout(function(){
        setInterval(function(){
            for(i=0;i<total;i++) {
                eval("var pus=test_compare"+i)
                if((typeof savetime[i]=="undefined")){
                    savetime[i]="0"
                }
                pus.unshift(savetime[i]);
                start_pus=pus.indexOf();
                last_pus=pus.lastIndexOf(!null);
                // console.log(pus,start_pus,last_pus,i);
               // console.log(pus)

                if((pus[0]==pus[1])&&pus[8]!=0){
                  //  console.log(array1[i])
                    if(document.getElementById('first'+(i)).className!="Loading") {
                        document.getElementById('first' + (i)).className = "flag4";
                        document.getElementById('first'+(i)).title="Wait for Signal";
                       // console.log(ipss[i])
                        if((typeof ipss[i]!="undefined")){
                            document.getElementById('first'+(i)).innerHTML="<h4>"+ipss[i]+"</h4>"+"<h5>"+array1[i]+"</h5><h5>Wait for signal</h5>\n<h6>&nbsp</h6>";
                        }else{
                            document.getElementById('first'+(i)).innerHTML="<h4>&nbsp</h4>"+"<h5>"+array1[i]+"</h5><h5>Wait for signal</h5>\n<h6>&nbsp</h6>";
                        }
                     //   websocsend.push(" "+array1[i]);
                        //var asdfeg=array1[i];
                        //ws.send(asdfeg)
                    }
                }
                if((pus[0]==pus[1])&&(pus[1]==pus[2])&&(pus[2]==pus[3])&&(pus[3]==pus[4])&&(pus[4]==pus[5])&&(pus[5]==pus[6])&&pus[6]==pus[7]){
                    //alert("이거 이상해")
                    document.getElementById('first' + (i)).className = "flag5";
                    document.getElementById('first'+(i)).title="Disconnected";
                    if((typeof ipss[i]!="undefined")){
                        document.getElementById('first'+(i)).innerHTML="<h4>"+ipss[i]+"</h4>"+"<h5>"+array1[i]+"</h5><h5>Disconnected</h5>\n<h6>&nbsp</h6>";
                    }else{
                        document.getElementById('first'+(i)).innerHTML="<h4>&nbsp</h4>"+"<h5>"+array1[i]+"</h5><h5>Disconnected</h5>\n<h6>&nbsp</h6>";
                    }
                    document.getElementById('first' + (i)).className = "flag5";

                    document.getElementById('first'+(i)).title="Disconnected";
                    websocsend.push(" "+array1[i]);
                    pus[1]=0;
                    pus[0]=1;
                    pus[2]=0;
                    pus[3]=0;
                    pus[4]=0;
                    pus[5]=0;
                    pus[6]=0;
                    pus[7]=0;
                    pus[8]=0;
                }
                if(pus.length>9){
                    pus.pop();
                }
            }
            //console.log(websocsend);
            send_soc();
           // console.log(websocsend);
        },1000*10*2); //15초

    },300);

   /* setTimeout(function(){
        setInterval(function(){
            for(i=0;i<table;i++) {
                eval("var pus=test_compare"+i)
                pus.push(savetime[i]);
                start_pus=pus.indexOf();
                last_pus=pus.lastIndexOf(!null);
                // console.log(pus,start_pus,last_pus,i);
                console.log(pus)
                if(pus[0]==pus[1]){
                    console.log(array1[i])
                    if(document.getElementById('first'+(i)).className!="Loading") {
                        document.getElementById('first' + (i)).className = "flag5";
                        document.getElementById('first'+(i)).title="No response From Ap";
                        websocsend.push(" "+array1[i]);
                        //var asdfeg=array1[i];
                        //ws.send(asdfeg)
                    }
                }
                if(pus.length>1){
                    pus.shift();
                }
            }
            console.log(websocsend);
            send_soc();
            console.log(websocsend);
        },1000*60*2); //30초

    },300);*/
    function send_soc(){
        setTimeout(function(){ws.send("errmac "+websocsend);
            websocsend=new Array();
            }, 100);
    }

    /*
     setInterval(function(){
     window.location.reload(true);
     },1000*60*60*1); //1시간마다 한번씩 리프레쉬
     */

    /* 장비가 죽었는지 확인하는 방법 1)
     setInterval(function(){
     for(i=0;i<table;i++)
     savetime1[i]=savetime[i];
     console.log(savetime1,"CCCCC"); //N초마다 savetime1에 저장.
     setTimeout(function() {
     for(i=0;i<table;i++){
     if(savetime1[i]===savetime[i]){
     if(document.getElementById('first'+(i)).className!="Loading") {
     document.getElementById('first' + (i)).className = "flag5";
     }
     }
     }
     console.log(savetime1,"AAAAAAAA");
     console.log(savetime,"BBBBBBBB");
     }, 1000*60*2);
     },1000*60*10);

     */
    /*for(i=0;i<table;i++){
     if(savetime1[i]===savetime[i]){
     document.getElementById('first'+(i)).className="flag5";
     }
     }
     console.log(savetime1);
     console.log(savetime);*/


    function addmac(){
            var promp=prompt("대문자, 소문자를 구분하여 MacAddress를 입력해주세요.");
            if (promp==null){
                alert("취소되었습니다.");
            }else if (promp.length!=17){
                alert("올바른 MacAddress가 아닙니다.");
            }else{
                window.open("http://" + server_url + ":8080/setlicense?rore=write&macAddr="+promp,"confirm",
                    "width=480,height=200,toolbar=no,location=no,status=no,left=250,top=" + i*24);
            }
            // document.getElementById(test.id).innerHTML="1111"
      /*  else if(test.className=="flag0"){
            var asd=document.getElementById(test.id).innerHTML
            var newName = "Show_Syslog";
            asd=asd.split('\n');
            asd=asd[0].split('<h4>')
            asd=asd[1].split('</h4>')
            window.open("http://" + server_url + ":8080/syslog?macAddr=" +asd[0], newName + asd[0],
                "width=750,height=600,toolbar=no,location=no,status=no,left=250,top=" + i*24);
            console.log(asd[0])
        }*/
        // document.getElementById(test.id).classList.toggle("show");
    }
    var clickedmac; //클릭(좌,우)시 맥어드레스가 저장되는 변수
    var clickedip;
    var enableweb;
    var enablesys;
    var enableaddmac;
    function savemac(text){
        var asd=document.getElementById(text.id).innerHTML
      //  console.log(asd)
        if (asd.indexOf(".")==-1){
            enableweb="stop";
        }else{
            enableweb="go";
        }
        if(text.className=="Loading"){
            enablesys="stop";
            enableaddmac="go";
        }else{
            enablesys="go";
            enableaddmac="stop";
        }
        if(asd.indexOf('.')!=-1){
            qwe=asd.split('&nbsp;</h4>');
            qwe=qwe[0].split('<h4>')
            clickedip=qwe[1];
        }else{
            clickedip=""
        }
        asd1=asd.split('</h5>');
       // console.log(asd1[1])
        asd1=asd1[0].split('<h5>');
        clickedmac=asd1[1];
        console.log(clickedip,clickedmac)



    }
    function goweb(){
        console.log(clickedip);
        window.open("http://"+clickedip);

    }
    function showsyslog(){
        //console.log(clickedmac,"눌렸엉") //디버깅용
            var newName = "Show_Syslog";
            window.open("http://" + server_url + ":8080/syslog?macAddr=" +clickedmac+"&ip="+clickedip, newName + clickedmac,
               "width=750,height=700,toolbar=no,location=no,status=no,left=250");
        // document.getElementById(test.id).classList.toggle("show");
    }

    $(function(){
        $(document).contextmenu(
            {
                delegate: "div.button",
                preventContextMenuForPopup: true,
                preventSelect: true,
                taphold: true,
                menu: [
                {title: "Load Syslog", cmd: "func1"},
                    {title: "Go To ApTool", cmd: "func2",disabled: true},
                    {title: "Add macAddr", cmd: "func3",disabled: true},
                    {title: "-----"},
                {title: "Exit", cmd: "func4" },
                //  {title: "Paste <kbd>Ctrl+V</kbd>", cmd: "paste1", uiIcon: "ui-icon-clipboard", disabled: true },
                //    {title: "----"},
                //{title: "Developing", cmd: "func3"},
                /*{title: "More", children: [
                 {title: "Use an 'action' callback", action: function(event, ui) {
                 alert("action callback sub1");
                 } },
                 {title: "Tooltip (static)", cmd: "sub2", tooltip: "Static tooltip"},
                 {title: "Tooltip (dynamic)", tooltip: function(event, ui){ return "" + Date(); }},
                 {title: "Custom icon", cmd: "browser", uiIcon: "ui-icon custom-icon-firefox"},
                 {title: "Disabled (dynamic)", disabled: function(event, ui){
                 return false;
                 }}
                 ]}
                 */
            ],
            // Handle menu selection to implement a fake-clipboard
            select: function(event, ui) {
                var $target = ui.target;
                switch(ui.cmd){
                    case "func1":
                        showsyslog();
                        break;
                    case "func2":
                        goweb();
                        break;
                    case "func3":
                        addmac();
                        break;
                }
                clickedmac=""
            },
            // Implement the beforeOpen callback to dynamically change the entries
             beforeOpen: function(event, ui) {
             var $menu = ui.menu,
             $target = ui.target,
             extraData = ui.extraData; // passed when menu was opened by call to open()

             // console.log("beforeOpen", event, ui, event.originalEvent.type);

             $(document)
             //        .contextmenu("replaceMenu", [{title: "aaa"}, {title: "bbb"}])
             //        .contextmenu("replaceMenu", "#options2")
             //        .contextmenu("setEntry", "cut", {title: "Cuty", uiIcon: "ui-icon-heart", disabled: true})
                 .contextmenu("enableEntry", "func3", (enableaddmac !== "stop"))
                 .contextmenu("enableEntry", "func2", (enableweb !== "stop"))
                 .contextmenu("enableEntry", "func1", (enablesys !== "stop"));
             // Optionally return false, to prevent opening the menu now
             }
        });

    });
    function mapinfo(){
        showopen=window.open("http://" + server_url + ":8080/maploc","nodeok","menubar=0 width=1, height=1");
        setInterval(function() {
            showopen.close();
            location.href="mapmak.html";
        },1000);
    }
    function macsortnum(str,num){
        //console.log(str)
        var sortarray=str.split("<\/button>");
        var imsi=""
        var resultstring=""
      if (num>2){
            for(;;){
                var k=0;
                for(i=0;i<num-1;i++){
                    if(sortarray[i].split("<\/h5>")[0].split("<h5>")[1]>sortarray[i+1].split("<\/h5>")[0].split("<h5>")[1]){
                        imsi=sortarray[i+1];
                        sortarray[i+1]=sortarray[i];
                        sortarray[i]=imsi;
                        k++
                    }
                }
                if(k==0){
                    break
                }
            }

            for(i=0;i<num;i++){
                resultstring+=sortarray[i]+"<\/button>"
            }
            console.log(num);
            return resultstring
        }else{
            return str
        }
    }
    function ipsortnum(str,num){
        var sortarray=str.split("<\/button>");
        var imsi=""
        var resultstring=""
        if (num>2){
            for(;;){
                var k=0;
                for(i=0;i<num-1;i++){
                    console.log(sortarray[i].split("<\/h4>")[0].split("<h4>")[1].split(".")[3].split("&nbsp;")[0]*1)
                     if(sortarray[i].split("<\/h4>")[0].split("<h4>")[1].split(".")[3].split("&nbsp;")[0]*1>sortarray[i+1].split("<\/h4>")[0].split("<h4>")[1].split(".")[3].split("&nbsp;")[0]*1){
                         imsi=sortarray[i+1];
                        // alert("1")
                        sortarray[i+1]=sortarray[i];
                        sortarray[i]=imsi;
                        k++

                  }
                    }
                if(k==0){
                    break
                }
            }
            for(;;){
                var k=0;
                for(i=0;i<num-1;i++){
                     if(sortarray[i].split("<\/h4>")[0].split("<h4>")[1].split(".")[2]*1>sortarray[i+1].split("<\/h4>")[0].split("<h4>")[1].split(".")[2]*1){
                         imsi=sortarray[i+1];
                        sortarray[i+1]=sortarray[i];
                        sortarray[i]=imsi;
                        k++
                 }
                }
                if(k==0){
                    break
                }
            }

            for(i=0;i<num;i++){
                resultstring+=sortarray[i]+"<\/button>"
            }
            console.log(num);
            //console.log(resultstring)
            return resultstring
        }else{
            return str
        }


    }
    //var pop_status=new;
    var  pop_status=new Object();
    function loadxml(meshid){
        window.open("http://" + server_url + ":8080/showmeshid?meshid="+meshid+"&meshurl="+server_url,"nodeok","menubar=0 width=1, height=1");
        if(typeof pop_status[meshid]=="undefined"){
            setTimeout(function(){
                pop_status[meshid]=window.open("http://" + server_url + ":8100/showmesh",meshid,"width=520,height=625");
            }, 1000);//,toolbar=no,location=no,left=250
        }else{
            if(pop_status[meshid].closed!=true){
                pop_status[meshid].close()
                setTimeout(function(){
                    pop_status[meshid]=window.open("http://" + server_url + ":8100/showmesh",meshid,"width=520,height=625");
                }, 1000);//,toolbar=no,location=no,left=250

            }else{
                setTimeout(function(){
                    pop_status[meshid]=window.open("http://" + server_url + ":8100/showmesh",meshid,"width=520,height=625");
                }, 1000);//,toolbar=no,location=no,left=250
            }
        }






    }

    function findString (swc) {
        var infinitstring="";
        var macsortstring="";
        var ipsortstring="";
        var infinitstring1="";
        var classbase="";
        var numflag0=0;
        var ak="";
        var node = document.getElementsByClassName("button")[0];
        var sortarray=node.innerHTML.split("<\/script>");
   //     alert(swc)
        sortarray=sortarray[1].split("<\/button>");
            for(i=0;i<table;i++){
                if (sortarray[i].indexOf("flag0") !== -1){
                    infinitstring+=sortarray[i]+"<\/button>";
                    numflag0++
                }else if (sortarray[i].indexOf("class=\"Loading\"")){
                    classbase+=sortarray[i]+"<\/button>"
                }else{
                    infinitstring1+=sortarray[i]+"<\/button>"
                }
            }
        if (swc=="1"){
            ipsortstring=ipsortnum(infinitstring,numflag0);
            node.innerHTML="<script>\n" +
                "                                    maketable();\n" +
                "                                <\/script>"+ ipsortstring+infinitstring1+classbase
        }else if(swc=="2"){
            macsortstring=macsortnum(infinitstring,numflag0);
          //  console.log(macsortstring)
            node.innerHTML="<script>\n" +
                "                                    maketable();\n" +
                "                                <\/script>"+macsortstring+infinitstring1+classbase
        }else{

        }
       // alert(total)
        //alert(node.childNodes.length)
    }


</script>
